<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>
      çºªå¹´ |ã€ç¬¬ä¸‰æœŸã€‘Vue3 Release æºç è§£è¯»è®°å½• | Journey&Flower
    </title>
    <meta name="description" content="A VitePress site">
    <link rel="stylesheet" href="/blog/_assets/style.3bcb4d30.css">
    <link rel="modulepreload" href="/blog/_assets/common-bec3f312.js">
    <link rel="modulepreload" href="/blog/_assets/docs_vue3-release.md.fda87cce.lean.js">
    <link rel="modulepreload" href="/blog/_assets/app.5430140b.js">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta name="keywords" content="Journey&amp;Flower">
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="https://lib.baomitu.com/gitalk/1.7.0/gitalk.min.css">
    <script src="https://lib.baomitu.com/gitalk/1.7.0/gitalk.min.js"></script>
    <script src="https://lib.baomitu.com/axios/0.21.1/axios.js"></script>
    
  </head>
  <body>
    <div id="app"><!--[--><div id="containerColor" class="no-sidebar theme" data-v-4dc7fc30><header class="navbar" data-v-4dc7fc30><!--[--><a class="title" aria-label="Journey&amp;Flower, back to home" href="/blog/"><img class="logo" src="/blog/favicon.ico" alt="logo"><span>Journey&amp;Flower</span></a><div class="flex-grow"></div><nav class="nav-links hide-mobile" data-v-4dc7fc30><!--[--><!--[--><div class="nav-item" data-v-4dc7fc30><a class="nav-link" href="/blog/index.html" target="" rel="">ğŸ  é¦–é¡µ <!----></a></div><!--]--><!--[--><div class="nav-item" data-v-4dc7fc30><a class="nav-link" href="/blog/more/docs.html" target="" rel="">ğŸ“… å½’æ¡£ <!----></a></div><!--]--><!--[--><div class="nav-item" data-v-4dc7fc30><a class="nav-link" href="/blog/more/tags.html" target="" rel="">ğŸ“‚ åˆ†ç±» <!----></a></div><!--]--><!--[--><div class="nav-item" data-v-4dc7fc30><a class="nav-link" href="/blog/more/Friendship.html" target="" rel="">ğŸ‘« å‹æƒ…é“¾æ¥ <!----></a></div><!--]--><!--]--><!----><!----></nav><!--[--><!--[--><!--]--><!--]--><!--]--><div class="sidebar-button" data-v-4dc7fc30><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div></header><aside class="" data-v-4dc7fc30><!--[--><nav class="nav-links show-mobile" data-v-4dc7fc30><!--[--><!--[--><div class="nav-item" data-v-4dc7fc30><a class="nav-link" href="/blog/index.html" target="" rel="">ğŸ  é¦–é¡µ <!----></a></div><!--]--><!--[--><div class="nav-item" data-v-4dc7fc30><a class="nav-link" href="/blog/more/docs.html" target="" rel="">ğŸ“… å½’æ¡£ <!----></a></div><!--]--><!--[--><div class="nav-item" data-v-4dc7fc30><a class="nav-link" href="/blog/more/tags.html" target="" rel="">ğŸ“‚ åˆ†ç±» <!----></a></div><!--]--><!--[--><div class="nav-item" data-v-4dc7fc30><a class="nav-link" href="/blog/more/Friendship.html" target="" rel="">ğŸ‘« å‹æƒ…é“¾æ¥ <!----></a></div><!--]--><!--]--><!----><!----></nav><!--[--><!--[--><!--]--><!--]--><ul class="sidebar"><!--[--><!--]--></ul><!--[--><!--[--><!--]--><!--]--><!--]--></aside><!----><!-- TODO: make this button accessible --><div class="sidebar-mask" data-v-4dc7fc30></div><main data-v-4dc7fc30><!--[--><div class="content"><!--[--><!--[--><!--]--><!--]--><div class="md-header"><div class="md-title">çºªå¹´ |ã€ç¬¬ä¸‰æœŸã€‘Vue3 Release æºç è§£è¯»è®°å½•</div><span id="jinrishici-sentence">æ­£åœ¨åŠ è½½ä»Šæ—¥è¯—è¯....</span><div class="md-date">2021-08-25</div></div><ul class="catalog"><!--[--><li class="catalog-item"><a class="level level-2" href="#_1-å­¦ä¹ ç›®æ ‡å’Œèµ„æºå‡†å¤‡">1. å­¦ä¹ ç›®æ ‡å’Œèµ„æºå‡†å¤‡</a><!----></li><li class="catalog-item"><a class="level level-2" href="#_2-yarn-workspace">2. Yarn Workspace</a><!----></li><li class="catalog-item"><a class="level level-2" href="#_3-release-js-æ–‡ä»¶è§£è¯»">3. release.js æ–‡ä»¶è§£è¯»</a><!----></li><li class="catalog-item"><!----><a class="level level-3" href="#main-å‡½æ•°">main å‡½æ•°</a></li><li class="catalog-item"><a class="level level-2" href="#_4-æ„Ÿæƒ³">4. æ„Ÿæƒ³</a><!----></li><li class="catalog-item"><a class="level level-2" href="#_5-å®è·µ">5. å®è·µ</a><!----></li><!--]--></ul><div data-v-4dc7fc30><blockquote><p>ã€è‹¥å·ã€‘Vue3 Release æºç è§£è¯»ï¼š<a href="https://juejin.cn/post/6997943192851054606" target="_blank" rel="noopener noreferrer">https://juejin.cn/post/6997943192851054606</a></p></blockquote><h2 id="_1-å­¦ä¹ ç›®æ ‡å’Œèµ„æºå‡†å¤‡"><a class="header-anchor" href="#_1-å­¦ä¹ ç›®æ ‡å’Œèµ„æºå‡†å¤‡" aria-hidden="true">#</a> 1. å­¦ä¹ ç›®æ ‡å’Œèµ„æºå‡†å¤‡</h2><p>è¿™ä¸€æœŸé˜…è¯»çš„æ˜¯ Vue3 æºç ä¸­çš„ script/release.js ä»£ç ï¼Œä¹Ÿå°±æ˜¯ Vue.js çš„å‘å¸ƒæµç¨‹ã€‚åœ¨ä¸Šä¸€æœŸæºç é˜…è¯»ä¸­ä» <a href="https://github.com/vuejs/vue-next/blob/master/.github/contributing.md" target="_blank" rel="noopener noreferrer">.github/contributing.md</a> äº†è§£åˆ° Vue.js é‡‡ç”¨çš„æ˜¯ monorepo çš„æ–¹å¼è¿›è¡Œä»£ç çš„ç®¡ç†ã€‚</p><p>monorepo æ˜¯ç®¡ç†é¡¹ç›®ä»£ç çš„ä¸€ä¸ªæ–¹å¼ï¼ŒæŒ‡åœ¨ä¸€ä¸ªé¡¹ç›®ä»“åº“ (repo) ä¸­ç®¡ç†å¤šä¸ªæ¨¡å—/åŒ… (package)ï¼Œä¸åŒäºå¸¸è§çš„æ¯ä¸ª package éƒ½å»ºä¸€ä¸ª repoã€‚</p><p>åˆšå¥½æˆ‘æœ€è¿‘æ­å»ºç»„ä»¶åº“ä¹Ÿæ˜¯ä½¿ç”¨ monorepo çš„æ–¹å¼å»ç®¡ç†åŒ…ã€‚ monorepo æœ‰ä¸ªç¼ºç‚¹ï¼Œå› ä¸ºæ¯ä¸ªåŒ…éƒ½ç»´æŠ¤ç€è‡ªå·±çš„ dependenciesï¼Œé‚£ä¹ˆåœ¨ install çš„æ—¶å€™ä¼šå¯¼è‡´ node_modules çš„ä½“ç§¯éå¸¸å¤§ã€‚ç›®å‰æœ€å¸¸è§çš„ monorepo è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨ lerna å’Œ yarn çš„ workspaces ç‰¹æ€§å»å¤„ç†ä»“åº“çš„ä¾èµ–ï¼Œæˆ‘æ­å»ºçš„ç»„ä»¶åº“ä¹Ÿæ˜¯ä½¿ç”¨äº† lerna å’Œ yarnã€‚ä½† Vue3 çš„åŒ…ç®¡ç†æ²¡æœ‰ä½¿ç”¨ lernaï¼Œå®ƒæ˜¯æ€ä¹ˆç®¡ç†ä¾èµ–åŒ…çš„ç‰ˆæœ¬å·å‘¢ï¼Ÿè®©æˆ‘ä»¬è·Ÿç€æºç ä¸€æ¢ç©¶ç«Ÿã€‚</p><blockquote><p><a href="https://www.lernajs.cn/" target="_blank" rel="noopener noreferrer">Lerna</a> æ˜¯ä¸€ä¸ªç®¡ç†å·¥å…·ï¼Œç”¨äºç®¡ç†åŒ…å«å¤šä¸ªè½¯ä»¶åŒ…ï¼ˆpackageï¼‰çš„ JavaScript é¡¹ç›®ï¼Œé’ˆå¯¹ä½¿ç”¨ git å’Œ npm ç®¡ç†å¤šè½¯ä»¶åŒ…ä»£ç ä»“åº“çš„å·¥ä½œæµç¨‹è¿›è¡Œä¼˜åŒ–ã€‚</p></blockquote><p><strong>å­¦ä¹ ç›®æ ‡ï¼š</strong></p><p>1ï¼‰å­¦ä¹  release.js æºç ï¼Œè¾“å‡ºè®°å½•æ–‡æ¡£ã€‚</p><p><strong>èµ„æºå‡†å¤‡ï¼š</strong></p><p>Vue3 æºç åœ°å€ï¼š<code>https://github.com/vuejs/vue-next</code></p><h2 id="_2-yarn-workspace"><a class="header-anchor" href="#_2-yarn-workspace" aria-hidden="true">#</a> 2. Yarn Workspace</h2><div class="language-typescript"><pre><code><span class="token comment">// vue-next/package.json ï¼ˆå¤šä½™çš„ä»£ç å·²çœç•¥ï¼‰</span>
<span class="token punctuation">{</span>
    <span class="token string">&quot;private&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;3.2.2&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;workspaces&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;packages/*&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;release&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node scripts/release.js&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Yarn ä» 1.0 ç‰ˆå¼€å§‹æ”¯æŒ Workspace ï¼ˆå·¥ä½œåŒºï¼‰ï¼ŒWorkspace å¯ä»¥æ›´å¥½çš„ç»Ÿä¸€ç®¡ç†æœ‰å¤šä¸ªé¡¹ç›®çš„ä»“åº“ã€‚</p><ul><li>ç®¡ç†ä¾èµ–å…³ç³»ä¾¿æ·ï¼šæ¯ä¸ªé¡¹ç›®ä½¿ç”¨ç‹¬ç«‹çš„ package.json ç®¡ç†ä¾èµ–ï¼Œå¯ä»¥ä½¿ç”¨ yarn å‘½ä»¤ä¸€æ¬¡æ€§å®‰è£…æˆ–è€…å‡çº§æ‰€æœ‰ä¾èµ–ï¼Œæ— éœ€åœ¨æ¯ä¸ªç›®å½•ä¸‹åˆ†åˆ«å®‰è£…ä¾èµ–</li><li>é™ä½ç£ç›˜ç©ºé—´å ç”¨ï¼šå¯ä»¥ä½¿å¤šä¸ªé¡¹ç›®å…±äº«åŒä¸€ä¸ª node_modules ç›®å½•</li></ul><h2 id="_3-release-js-æ–‡ä»¶è§£è¯»"><a class="header-anchor" href="#_3-release-js-æ–‡ä»¶è§£è¯»" aria-hidden="true">#</a> 3. release.js æ–‡ä»¶è§£è¯»</h2><p>å…ˆæ‰‹åŠ¨è·‘ä¸€é <code>yarn run release --dry</code>ï¼Œæ§åˆ¶å°ä¼šè¾“å‡ºä»¥ä¸‹ä¿¡æ¯ï¼ˆå¤šä½™ä¿¡æ¯å·²çœç•¥ï¼‰ï¼Œä»æ§åˆ¶å°æ—¥å¿—çœ‹å‡ºæ¥ï¼Œå‘å¸ƒ Vue.js ä¼šç»å†ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><div class="language-"><pre><code>// ç¡®è®¤å‘å¸ƒç‰ˆæœ¬å·
? Select release type ... 
&gt; patch (3.2.3)
  minor (3.3.0)
  major (4.0.0)
  custom
// æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹
Running tests...
// æ›´æ–°ä¾èµ–ç‰ˆæœ¬
Updating cross dependencies...
// æ‰“åŒ…ç¼–è¯‘æ‰€æœ‰åŒ…
Building all packages...
// ç”Ÿæˆ changelog
conventional-changelog -p angular -i CHANGELOG.md -s
// æäº¤ä»£ç 
Committing changes...
// å‘å¸ƒåŒ…
Publishing packages...
// æ¨é€ä»£ç åˆ° GitHub
Pushing to GitHub...
</code></pre></div><p>åˆæ­¥äº†è§£å‘å¸ƒæµç¨‹åï¼Œæ¥çœ‹çœ‹ release.js æºç åšäº†ä»€ä¹ˆï¼Œå…ˆçœ‹å…¥å£å‡½æ•° main()</p><h3 id="main-å‡½æ•°"><a class="header-anchor" href="#main-å‡½æ•°" aria-hidden="true">#</a> main å‡½æ•°</h3><p>ä»£ç å¤ªå¤šå°±ä¸è´´ä»£ç äº†ï¼Œè®°å½•ä¸€ä¸‹æ€è·¯å’Œæ€è€ƒ</p><ol><li>ç¡®è®¤è¦å‘å¸ƒçš„ç‰ˆæœ¬ï¼š</li></ol><ul><li><ul><li>å¦‚æœä»å‘½ä»¤è¡Œè·å–åˆ°äº†ç‰ˆæœ¬å·ï¼Œå…ˆéªŒè¯ç‰ˆæœ¬å·è§„èŒƒï¼Œå†æ¬¡ç¡®è®¤ç‰ˆæœ¬å·</li><li>å¦‚æœå‘½ä»¤è¡Œæ²¡æœ‰è¾“å…¥ç‰ˆæœ¬å·ï¼Œä¼šè®©ç”¨æˆ·é€‰æ‹©ä¸€ä¸ªç‰ˆæœ¬å‘å¸ƒ</li></ul></li></ul><p>ç¡®è®¤ç‰ˆæœ¬å·ä½¿ç”¨äº†ä¸€ä¸ªåº“å« <strong>semver</strong>ï¼Œå®ƒçš„ä½œç”¨æ˜¯ç”¨äºç‰ˆæœ¬æ ¡éªŒæ¯”è¾ƒã€‚</p><div class="language-js"><pre><code><span class="token comment">// ç›®çš„æ˜¯è·å–å‘½ä»¤è¡Œå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯å…è®¸ç”¨æˆ·è‡ªå®šä¹‰è¾“å…¥ç‰ˆæœ¬å·ï¼Œæ¯”å¦‚ yarn release v3.5.0ï¼‰</span>
<span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;minimist&#39;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> targetVersion <span class="token operator">=</span> args<span class="token punctuation">.</span>_<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
</code></pre></div><ol start="2"><li>æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹</li></ol><div class="language-js"><pre><code><span class="token keyword">const</span> execa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;execa&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">run</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">bin<span class="token punctuation">,</span> args<span class="token punctuation">,</span> opts <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">execa</span><span class="token punctuation">(</span>bin<span class="token punctuation">,</span> args<span class="token punctuation">,</span> <span class="token punctuation">{</span> stdio<span class="token operator">:</span> <span class="token string">&#39;inherit&#39;</span><span class="token punctuation">,</span> <span class="token operator">...</span>opts <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">bin</span> <span class="token operator">=</span> <span class="token parameter">name</span> <span class="token operator">=&gt;</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;../node_modules/.bin/&#39;</span> <span class="token operator">+</span> name<span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>skipTests <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isDryRun<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// bin(&quot;jest&quot;) å…ˆè·å– node_modules/.bin/jest çš„ç›®å½•ï¼Œrun çš„æœ¬è´¨å°±æ˜¯æ‰§è¡Œå‘½ä»¤è¡Œ</span>
  <span class="token comment">// è¿™è¡Œä»£ç çš„æ„æ€å°±ç›¸å½“äºåœ¨å‘½ä»¤ç»ˆç«¯ï¼Œé¡¹ç›®æ ¹ç›®å½•è¿è¡Œ ./node_modules/.bin/jest å‘½ä»¤ã€‚</span>
  <span class="token keyword">await</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token function">bin</span><span class="token punctuation">(</span><span class="token string">&#39;jest&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;--clearCache&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token string">&#39;yarn&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;test&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;--bail&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">(skipped)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>æ›´æ–°ä¾èµ–ç‰ˆæœ¬</li></ol><div class="language-js"><pre><code><span class="token comment">// 1ï¼‰è·å– packages ç›®å½•ä¸‹çš„æ‰€æœ‰åŒ…</span>
<span class="token keyword">const</span> packages <span class="token operator">=</span> fs
  <span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;../packages&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">p</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>p<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">&#39;.ts&#39;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>p<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&#39;.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 1ï¼‰è·å–åŒ…çš„æ ¹ç›®å½•è·¯å¾„</span>
<span class="token keyword">const</span> <span class="token function-variable function">getPkgRoot</span> <span class="token operator">=</span> <span class="token parameter">pkg</span> <span class="token operator">=&gt;</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;../packages/&#39;</span> <span class="token operator">+</span> pkg<span class="token punctuation">)</span>
<span class="token comment">// 2ï¼‰æ›´æ–°æ ¹ç›®å½•å’Œ packages ç›®å½•ä¸‹æ¯ä¸ªåŒ…çš„ package.json çš„ç‰ˆæœ¬å·</span>
<span class="token keyword">function</span> <span class="token function">updateVersions</span><span class="token punctuation">(</span><span class="token parameter">version</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment">// 3ï¼‰å®ç°æ›´æ–° package.json ç‰ˆæœ¬å·çš„ï¼Œä»¥åŠæ›´æ–°ä¾èµ–åŒ…çš„ç‰ˆæœ¬å·</span>
<span class="token keyword">function</span> <span class="token function">updatePackage</span><span class="token punctuation">(</span><span class="token parameter">pkgRoot<span class="token punctuation">,</span> version</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment">// 4ï¼‰å®ç°æ›´æ–°ä¸ vue ç›¸å…³ä¾èµ–åŒ…çš„ç‰ˆæœ¬å·</span>
<span class="token keyword">function</span> <span class="token function">updateDeps</span><span class="token punctuation">(</span><span class="token parameter">pkg<span class="token punctuation">,</span> depType<span class="token punctuation">,</span> version</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><ol start="4"><li>æ‰“åŒ…ç¼–è¯‘æ‰€æœ‰åŒ…</li></ol><p>è¿™éƒ¨åˆ†æ¶‰åŠå¦å¤–ä¸€ä¸ªæ–‡ä»¶ script/build.jsï¼Œè¿™ä¸ªæ–‡ä»¶ä¸»è¦æ˜¯å°†å„ä¸ªåŒ…æ‰“åŒ…åœ¨å¯¹åº”çš„ç›®å½•ä¸‹ï¼Œæ¯”å¦‚æ‰“åŒ…ä¸€ä¸ªä¾èµ–å°±è¿è¡Œä¸€æ¬¡<code>yarn build</code>ï¼Œå¦‚æœæœ‰å¤šä¸ªåŒ…ï¼Œå°±å¼‚æ­¥å¾ªç¯è°ƒç”¨æ‰“åŒ…å‘½ä»¤ã€‚æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p><div class="language-javascript"><pre><code><span class="token comment">/**
 * è¿­ä»£æ‰“åŒ…
 * @param {*} maxConcurrency æœ€å¤§å¹¶å‘
 * @param {*} source ç›®å½•
 * @param {*} iteratorFn æ„å»ºå‡½æ•°ï¼ˆæ ¸å¿ƒå°±æ˜¯è¿è¡Œ build å‘½ä»¤ï¼‰
 * @returns
 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">runParallel</span><span class="token punctuation">(</span><span class="token parameter">maxConcurrency<span class="token punctuation">,</span> source<span class="token punctuation">,</span> iteratorFn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ret <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> executing <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> item <span class="token keyword">of</span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">iteratorFn</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ret<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>maxConcurrency <span class="token operator">&lt;=</span> source<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> e <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> executing<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>executing<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      executing<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>executing<span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> maxConcurrency<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span>executing<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="5"><li>ç”Ÿæˆ CHANGELOG æ–‡ä»¶</li></ol><p>ä¸»è¦è¿è¡Œçš„æ˜¯è¿™è¡Œå‘½ä»¤ï¼šconventional-changelog -p angular -i <a href="http://CHANGELOG.md" target="_blank" rel="noopener noreferrer">CHANGELOG.md</a> -s</p><ol start="6"><li>æäº¤ä»£ç </li></ol><p>å…ˆæ‰§è¡Œ git diff å‘½ä»¤ï¼Œæ£€æŸ¥æ–‡ä»¶æ˜¯å¦æœ‰ä¿®æ”¹ï¼Œå¦‚æœæœ‰ï¼Œæ‰§è¡Œ git add å’Œ git commit å‘½ä»¤</p><ol start="7"><li>å‘å¸ƒåŒ…</li></ol><p>æœ€åæ‰§è¡Œçš„å‘½ä»¤æ˜¯ï¼Œyarn publishï¼Œå‘å¸ƒæ–°ç‰ˆæœ¬å’Œæ‰“ Tag</p><ol start="8"><li>æ¨é€åˆ° GitHub</li></ol><p>ä¸»è¦è¿è¡Œçš„å‘½ä»¤ï¼š</p><ul><li><ul><li>æ‰“ tagï¼šgit tag ${version}</li><li>æ¨é€ tagï¼šgit push origin refs/tags/${version}</li></ul></li><li><ul><li>æäº¤ä»£ç åˆ°è¿œç¨‹ä»“åº“ï¼šgit push</li></ul></li></ul><p>è‡³æ­¤ï¼Œrelease å‘å¸ƒæµç¨‹å·²ç»åˆ†æå®Œäº†ã€‚</p><p><img src="https://cdn.nlark.com/yuque/0/2021/jpeg/1105483/1629654601778-17189d93-a9ad-447f-9ea0-70499c538a0e.jpeg" alt="release å‘å¸ƒæµç¨‹"></p><h2 id="_4-æ„Ÿæƒ³"><a class="header-anchor" href="#_4-æ„Ÿæƒ³" aria-hidden="true">#</a> 4. æ„Ÿæƒ³</h2><p>å›ç­”ä¸€ä¸‹å¼€ç¯‡çš„é—®é¢˜ï¼ŒVue æ˜¯å¦‚ä½•ç®¡ç†ç‰ˆæœ¬å·å‘¢ï¼Ÿé˜…è¯»å®Œæºç æˆ‘ä»¬ä¼šåˆ†ç°ï¼Œåœ¨å‘ç‰ˆçš„æ—¶å€™ä¼š<strong>ç»Ÿä¸€æ›´æ–°æ‰€æœ‰åŒ…çš„ package.json çš„ç‰ˆæœ¬å·</strong>ã€‚å¯¹æ¯”æˆ‘åœ¨æ­å»ºç»„ä»¶åº“è¿‡ç¨‹ä¸­ä½¿ç”¨çš„ lernaï¼Œå…¶å® lerna æ˜¯æŠŠ release è¿™ä¸€å¥—æµç¨‹å°è£…æˆäº†ä¸€ä¸ªåŒ…ï¼Œå®ƒé‡Œé¢å¤„ç†å‘åŒ…çš„æµç¨‹è·Ÿ Vue Release æµç¨‹åŸºæœ¬æ˜¯ä¸€è‡´çš„ã€‚</p><p>è¿™æ¬¡çš„æºç è§£è¯»è§£ç­”äº†æˆ‘çš„ä¸€äº›ç–‘æƒ‘ã€‚åœ¨æˆ‘æ­å»ºç»„ä»¶åº“çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¸€å¼€å§‹äº†è§£åˆ°çš„æ˜¯ä¸€ä¸ªç»„ä»¶ä¸€ä¸ªç›®å½•ï¼Œå•åŒ…æ¨é€åˆ° npm ç§åº“ã€‚è¿™æ ·åšçš„ç¼ºç‚¹å¾ˆæ˜æ˜¾ï¼Œéœ€è¦åœ¨æ¯ä¸ªç›®å½•å®‰è£…ä¸€éä¾èµ–ï¼Œå•ç‹¬å¤„ç†ç‰ˆæœ¬å·ã€‚åæ¥äº†è§£åˆ°äº† yarn workspaceï¼ŒçŸ¥é“å®ƒå¯ä»¥å¤„ç†ä¾èµ–å®‰è£…çš„é—®é¢˜ï¼Œä½†ç‰ˆæœ¬å·çš„å¤„ç†è¿˜æ˜¯æ²¡æœ‰è§£å†³æ–¹æ¡ˆã€‚äºæ˜¯æˆ‘å»å¯»æ‰¾ä¸šå†…æ¯”è¾ƒæµè¡Œçš„è§£å†³åŠæ³•ï¼Œå‘ç°å¤§éƒ¨åˆ†æ˜¯ä½¿ç”¨äº† lernaã€‚</p><p>äºæ˜¯æˆ‘å‘æˆ‘çš„ TL æ²Ÿé€šè¯¢é—®ï¼Œå¯å¦é‡‡ç”¨ yarn + lerna çš„æ–¹å¼æ¥æ­å»ºç»„ä»¶åº“ã€‚æˆ‘è®°å¾—ç‰¹åˆ«æ¸…æ¥šä»–åé—®æˆ‘ï¼Œé—®æˆ‘ lerna è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Œæˆ‘æ”¯æ”¯å¾å¾å›ç­”äº†å®˜ç½‘ä¸Šçš„ä»‹ç»ï¼Œå› ä¸ºæˆ‘å½“æ—¶å¯¹ lerna çš„äº†è§£ä»…åœç•™åœ¨å®˜ç½‘ä»¥åŠå®ƒçš„å¸¸ç”¨å‘½ä»¤ï¼Œå®é™…ä¸Šæˆ‘ä¸çŸ¥é“å®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ã€‚TL è§æˆ‘ç­”ä¸ä¸Šæ¥ï¼Œå›å¤äº†æˆ‘ä¸€å¥ã€å¦‚æ— å¿…è¦ï¼Œå‹¿å¢å®ä½“ã€‘ã€‚</p><p>é€šè¿‡è¿™æ¬¡çš„æºç é˜…è¯»ï¼Œæˆ‘å¯ä»¥å›ç­” TL åé—®æˆ‘çš„é‚£ä¸ªé—®é¢˜äº†ï¼Œlerna è§£å†³çš„æ˜¯å‘åŒ…æµç¨‹ä¸­ç‰ˆæœ¬å·å¤„ç†ï¼Œè‡ªåŠ¨ç”Ÿæˆ CHANGELOG æ–‡ä»¶ï¼Œæäº¤ä»£ç ï¼Œå‘å¸ƒåŒ…ï¼Œæ¨é€åˆ°ä»“åº“è¿™å‡ ä¸ªé—®é¢˜ï¼Œå®ƒæŠŠè¿™å‡ ä¸ªæµç¨‹å°è£…æˆå‘½ä»¤ä¾›ç”¨æˆ·ä½¿ç”¨ã€‚å®ƒä¸æ˜¯æ­å»ºç»„ä»¶åº“éå¿…è¦å¼•å…¥çš„å·¥å…·ï¼Œè™½ç„¶å¼•ç”¨äº† lerna ä¼šå¢åŠ äº†æ–°çš„å¤æ‚åº¦ï¼Œä½†åœ¨ä¸äº†è§£å‘åŒ…æµç¨‹çš„å‰æœŸä½¿ç”¨ lerna å¯ä»¥ä½¿ç»„ä»¶åº“å¼€å‘è€…æ›´ä¸“æ³¨äºç»„ä»¶å¼€å‘çš„å·¥ä½œä¸Šï¼Œè€Œä¸éœ€è¦è¿‡åº¦å…³æ³¨å¦‚ä½•å‘åŒ…ã€‚</p><h2 id="_5-å®è·µ"><a class="header-anchor" href="#_5-å®è·µ" aria-hidden="true">#</a> 5. å®è·µ</h2><p>ç»è¿‡ä¸€ç•ªæ€è€ƒï¼Œæˆ‘è®¤ä¸ºå¼•å…¥ lerna ç¡®å®ç»™ç³»ç»Ÿå¢åŠ äº†ä¸€äº›å¤æ‚åº¦ï¼Œå› ä¸ºå®ƒè¦æ±‚å¼€å‘äººå‘˜é¢å¤–å­¦ä¹  lerna çš„ä¸€äº›çŸ¥è¯†å’Œå‘½ä»¤ï¼Œå¢åŠ äº†å­¦ä¹ æˆæœ¬ä»¥åŠç³»ç»Ÿå¤æ‚åº¦ã€‚æˆ‘è§‰å¾—å¯ä»¥å‚è€ƒ Vue çš„ release.jsï¼Œå†™ä¸€ä¸ªé€‚ç”¨äºé¡¹ç›®çš„æ„å»ºå‘ç‰ˆè„šæœ¬ç”¨æ¥å‘åŒ…ï¼Œé™ä½ç³»ç»Ÿå¤æ‚åº¦ã€‚</p><p>é€»è¾‘ä»£ç åŸºæœ¬ä¸ Vue3 çš„ release.js å’Œ build.js ä¸€è‡´ï¼Œå»æ‰äº†ä¸€äº›æ²¡å¿…è¦çš„ä»£ç ï¼Œæ¯”å¦‚å•å…ƒæµ‹è¯•å’Œä¸€äº›ç¯å¢ƒåˆ¤æ–­ã€‚è¿˜ä¿®æ”¹äº†ä¸€ä¸‹ rollup.config.js çš„é…ç½®ï¼Œæ„Ÿè§‰ç”¨èµ·æ¥ç¡®å®æ¯” lerna å¥½ç”¨ä¸€äº›ã€‚æœ€ç»ˆæ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="/blog/_assets/vue3-release0.f3d9178b.png" alt=""></p><div id="gitalk-container" data-v-4dc7fc30></div></div><div class="links-wrapper" data-v-4dc7fc30><div class="prev-link"><!----></div><div class="next-link"><!----></div></div><div data-v-4dc7fc30><footer class="page-edit"><!--[--><a key="0" href="https://juejin.cn/user/3175045313607534"><img class="imgIcon" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC"></a><!--]--></footer><p class="platform"> ä»¥ä¸Šçš†ä¸º <a href="javascript:;">Journey&amp;Flower</a> æ–‡ç« å‘å¸ƒå¹³å° </p><p class="platform"> Copyright Â© 2020-2021 <a href="https://github.com/JourneyFlower">@Journey&amp;Flower</a></p></div><!--[--><!--[--><!--]--><!--]--></div><!-- åªæƒ³ç‚¹å‡»èƒŒæ™¯æ‰å…³é—­ è¯·ä½¿ç”¨ .self ä¿®é¥°ç¬¦ --><div style="display:none;" class="imgBox"><img src=""></div><!--]--></main><div class="theme-select" data-v-4dc7fc30><ul data-v-4dc7fc30><li class="active" data-v-4dc7fc30>â˜€ï¸</li><li class="" data-v-4dc7fc30>ğŸŒ‘</li></ul></div></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"README.md\":\"af7d5b78\",\"index.md\":\"2a4a6a96\",\"docs_Github-Pages.md\":\"5d692a55\",\"docs_co.md\":\"a5135a3c\",\"docs_launch-editor.md\":\"65e6ef14\",\"docs_vue3-release.md\":\"fda87cce\",\"docs_vue3-utils.md\":\"ff4efd54\",\"more_Friendship.md\":\"76509b63\",\"more_docs.md\":\"7ba47760\",\"more_index.md\":\"9f32afbc\",\"more_tags.md\":\"2157f70a\"}")</script>
    <script type="module" async src="/blog/_assets/app.5430140b.js"></script>
  </body>
</html>